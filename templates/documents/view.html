{% extends 'base.html' %}

{% block title %}View Document - MBBS Visa System{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3 py-md-4">
    <header class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mb-4">
        <div>
            <h1 class="h2 mb-1">View Document</h1>
            <p class="text-muted mb-0">{{ document.get_document_type_display }} — {{ document.filename }}</p>
        </div>
        <div class="d-flex flex-wrap gap-2">
            {% if profile_id %}
            <a href="{% url 'students:student_detail' profile_id %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2" aria-hidden="true"></i>Back to Student
            </a>
            {% endif %}
            <a href="{% url 'students:admin_dashboard' %}" class="btn btn-outline-secondary">
                <i class="bi bi-speedometer2 me-2" aria-hidden="true"></i>Dashboard
            </a>
            <a href="{% url 'documents:download' document.id %}" class="btn btn-primary">
                <i class="bi bi-download me-2" aria-hidden="true"></i>Download
            </a>
        </div>
    </header>

    <div class="card theme-card">
        <div class="card-header">
            <h2 class="h5 mb-0">
                <i class="bi bi-file-earmark me-2" aria-hidden="true"></i>Document Preview
            </h2>
        </div>
        <div class="card-body p-0">
            {% if is_previewable %}
                {% if is_pdf %}
                <div class="p-3">
                    <iframe src="{{ document.file.url }}" class="w-100 border rounded" style="height: 80vh; min-height: 500px; border-color: var(--theme-border);" title="Document preview"></iframe>
                </div>
                {% else %}
                <div class="p-3 text-center">
                    <img src="{{ document.file.url }}" alt="Document preview" class="img-fluid rounded shadow-sm" style="max-height: 80vh;">
                </div>
                {% endif %}
            {% else %}
            <div class="p-5 text-center">
                <i class="bi bi-file-earmark-binary text-muted" style="font-size: 4rem;" aria-hidden="true"></i>
                <p class="text-muted mt-3">This file type cannot be previewed in the browser.</p>
                <a href="{% url 'documents:download' document.id %}" class="btn btn-primary mt-2">
                    <i class="bi bi-download me-2" aria-hidden="true"></i>Download to View
                </a>
            </div>
            {% endif %}
        </div>
        <footer class="card-footer d-flex flex-column flex-md-row justify-content-between align-items-center gap-2" style="background: var(--theme-surface); border-top: 1px solid var(--theme-border);">
            <div class="small text-muted">
                Student: <strong>{{ document.student.get_full_name|default:document.student.username }}</strong>
                · Type: {{ document.get_document_type_display }}
                · Size: {{ document.file_size }} KB
            </div>
            <a href="{% url 'documents:download' document.id %}" class="btn btn-primary">
                <i class="bi bi-download me-2" aria-hidden="true"></i>Confirm & Download
            </a>
        </footer>
    </div>
</div>
{% endblock %}
